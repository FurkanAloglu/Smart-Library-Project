<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cezalarım | SmartLibrary</title>
    <link rel="icon" type="image/png" href="https://img.icons8.com/ios-filled/100/2563eb/library.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-slate-50 text-slate-800 font-sans min-h-screen">

    <main class="container mx-auto px-6 py-8">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h2 class="text-3xl font-black text-slate-800 tracking-tight">Ceza ve Borçlarım</h2>
                <p class="text-slate-500 font-medium text-sm">Geçmiş iadelerinizden kaynaklanan cezalar</p>
            </div>
            
            <div class="bg-white px-6 py-4 rounded-2xl border border-rose-100 shadow-sm flex items-center gap-4">
                <div class="bg-rose-100 p-3 rounded-xl text-rose-600">
                    <i class="fa-solid fa-wallet text-2xl"></i>
                </div>
                <div>
                    <span class="text-xs text-slate-400 font-bold uppercase tracking-wider block">TOPLAM BORÇ</span>
                    <span id="totalDebt" class="text-2xl font-black text-rose-600">0.00 ₺</span>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-slate-50 border-b border-slate-100 text-xs uppercase tracking-wider text-slate-500 font-bold">
                            <th class="p-5">Kitap Adı</th>
                            <th class="p-5">Son Teslim</th>
                            <th class="p-5">İade Tarihi</th>
                            <th class="p-5 text-right">Ceza Tutarı</th>
                        </tr>
                    </thead>
                    <tbody id="penaltyTableBody" class="text-sm text-slate-600 divide-y divide-slate-100">
                        <tr><td colspan="4" class="p-10 text-center text-slate-400"><i class="fa-solid fa-circle-notch fa-spin"></i> Yükleniyor...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script type="module">
        import { loadNavbar } from './assets/js/layout.js';
        import { request } from './assets/js/api.js';

        async function init() {
            await loadNavbar();
            loadMyPenalties();
        }

        async function loadMyPenalties() {
            try {
                // Backend'deki endpoint: /api/penalties/my
                const penalties = await request('/penalties/my');
                renderPenalties(penalties || []);
            } catch (error) {
                console.error(error);
                document.getElementById('penaltyTableBody').innerHTML = 
                    `<tr><td colspan="4" class="p-10 text-center text-rose-500 font-bold">Veriler yüklenemedi!</td></tr>`;
            }
        }

        function renderPenalties(data) {
            const tbody = document.getElementById('penaltyTableBody');
            let total = 0;

            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="p-16 text-center">
                            <div class="text-slate-300 text-5xl mb-4"><i class="fa-regular fa-face-smile"></i></div>
                            <p class="text-slate-500 font-medium">Harika! Hiç cezanız bulunmuyor.</p>
                        </td>
                    </tr>`;
                document.getElementById('totalDebt').innerText = "0.00 ₺";
                return;
            }

            tbody.innerHTML = data.map(p => {
                total += p.amount;
                return `
                <tr class="hover:bg-slate-50 transition">
                    <td class="p-5 font-bold text-slate-700">
                        <i class="fa-solid fa-book text-slate-300 mr-2"></i> ${p.bookTitle}
                    </td>
                    <td class="p-5 text-xs font-mono text-slate-500">
                        ${new Date(p.dueDate).toLocaleDateString('tr-TR')}
                    </td>
                    <td class="p-5 text-xs font-mono text-rose-600 font-bold">
                        ${new Date(p.returnDate).toLocaleDateString('tr-TR')}
                    </td>
                    <td class="p-5 text-right font-black text-rose-600 text-base">
                        ${p.amount.toFixed(2)} ₺
                    </td>
                </tr>`;
            }).join('');

            document.getElementById('totalDebt').innerText = total.toFixed(2) + " ₺";
        }

        init();
    </script>
</body>
</html>